{
    "$schema":  "http://json-schema.org/draft-07/schema#",
    "$id":  "https://chrystallum.org/schemas/error_envelope.json",
    "title":  "Generic Error Envelope",
    "description":  "Standard error wrapper for all port outputs",
    "type":  "object",
    "required":  [
                     "request_id",
                     "status"
                 ],
    "properties":  {
                       "request_id":  {
                                          "type":  "string",
                                          "description":  "Unique request identifier for tracing"
                                      },
                       "status":  {
                                      "type":  "string",
                                      "enum":  [
                                                   "success",
                                                   "partial",
                                                   "error",
                                                   "timeout"
                                               ],
                                      "description":  "Overall operation status"
                                  },
                       "data":  {
                                    "type":  "object",
                                    "description":  "Payload-specific data (schema defined per port)",
                                    "additionalProperties":  false
                                },
                       "error":  {
                                     "type":  [
                                                  "object",
                                                  "null"
                                              ],
                                     "properties":  {
                                                        "code":  {
                                                                     "type":  "string",
                                                                     "description":  "Machine-readable error code"
                                                                 },
                                                        "message":  {
                                                                        "type":  "string",
                                                                        "description":  "Human-readable error message"
                                                                    },
                                                        "retry_after_ms":  {
                                                                               "type":  "integer",
                                                                               "minimum":  0,
                                                                               "description":  "Milliseconds to wait before retry"
                                                                           },
                                                        "fatal":  {
                                                                      "type":  "boolean",
                                                                      "description":  "Whether error is recoverable"
                                                                  },
                                                        "context":  {
                                                                        "type":  "object",
                                                                        "description":  "Additional error context",
                                                                        "additionalProperties":  false
                                                                    }
                                                    },
                                     "required":  [
                                                      "code",
                                                      "message",
                                                      "fatal"
                                                  ],
                                     "additionalProperties":  false
                                 },
                       "metrics":  {
                                       "type":  "object",
                                       "properties":  {
                                                          "duration_ms":  {
                                                                              "type":  "integer",
                                                                              "minimum":  0,
                                                                              "description":  "Operation duration in milliseconds"
                                                                          },
                                                          "retry_count":  {
                                                                              "type":  "integer",
                                                                              "minimum":  0,
                                                                              "description":  "Number of retries attempted"
                                                                          },
                                                          "component":  {
                                                                            "type":  "string",
                                                                            "description":  "Component that processed the request"
                                                                        }
                                                      },
                                       "additionalProperties":  false
                                   }
                   },
    "additionalProperties":  false
}