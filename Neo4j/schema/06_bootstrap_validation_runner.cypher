WITH ['human_entity_id_unique','human_qid_unique','human_viaf_id_unique','place_entity_id_unique','place_qid_unique','place_pleiades_id_unique','place_tgn_id_unique','place_version_id_unique','geometry_id_unique','event_entity_id_unique','event_qid_unique','period_entity_id_unique','period_qid_unique','year_entity_id_unique','year_year_number_unique','organization_entity_id_unique','organization_qid_unique','institution_entity_id_unique','dynasty_entity_id_unique','legal_restriction_entity_id_unique','work_entity_id_unique','work_qid_unique','position_entity_id_unique','material_entity_id_unique','object_entity_id_unique','activity_entity_id_unique','gens_entity_id_unique','praenomen_entity_id_unique','cognomen_entity_id_unique','subject_concept_id_hash_unique','human_id_hash_unique','gens_id_hash_unique','praenomen_id_hash_unique','cognomen_id_hash_unique','event_id_hash_unique','place_id_hash_unique','period_id_hash_unique','dynasty_id_hash_unique','institution_id_hash_unique','legal_restriction_id_hash_unique','claim_id_hash_unique','organization_id_hash_unique','year_id_hash_unique','analysis_run_id_unique','facet_assessment_id_unique','facet_category_key_unique','subject_concept_id_unique','claim_id_unique','claim_cipher_unique','retrieval_context_id_unique','agent_id_unique','entity_has_id','entity_has_type','human_has_name','human_has_qid','place_has_label','place_has_qid','year_has_year_number','event_has_label','event_has_start_date','event_has_qid','period_has_label','period_has_start','subject_concept_has_label','subject_concept_has_subject_id','work_has_qid','claim_has_text','claim_has_confidence','claim_has_cipher'] AS expected_constraints, ['entity_id_index','human_entity_id_index','place_entity_id_index','event_entity_id_index','period_entity_id_index','organization_entity_id_index','year_entity_id_index','subject_concept_id_hash_index','human_id_hash_index','gens_id_hash_index','praenomen_id_hash_index','cognomen_id_hash_index','event_id_hash_index','place_id_hash_index','period_id_hash_index','dynasty_id_hash_index','institution_id_hash_index','legal_restriction_id_hash_index','claim_id_hash_index','organization_id_hash_index','year_id_hash_index','qid_lookup_index','human_viaf_lookup','place_pleiades_lookup','place_tgn_lookup','work_qid_lookup','year_number_index','year_iso_index','claim_id_index','claim_cipher_index','retrieval_context_id_index','subject_id_index','agent_id_index','event_start_date_index','event_end_date_index','event_start_date_min_index','event_start_date_max_index','event_end_date_min_index','event_end_date_max_index','event_temporal_bbox_index','period_start_index','period_end_index','period_earliest_start_index','period_latest_start_index','period_earliest_end_index','period_latest_end_index','period_start_date_min_index','period_start_date_max_index','period_end_date_min_index','period_end_date_max_index','period_temporal_bbox_index','period_temporal_bbox_minmax_index','human_birth_date_index','human_death_date_index','human_birth_date_min_index','human_birth_date_max_index','human_death_date_min_index','human_death_date_max_index','human_lifespan_bbox_index','place_version_start_index','place_version_end_index','entity_type_index','period_facet_index','facet_category_key_index','subject_tier_index','subject_concept_status_index','human_status_index','gens_status_index','praenomen_status_index','cognomen_status_index','event_status_index','place_status_index','period_status_index','dynasty_status_index','institution_status_index','legal_restriction_status_index','claim_status_index','organization_status_index','year_status_index','event_type_index','claim_confidence_index','subject_confidence_index','retrieval_context_agent_index','retrieval_context_timestamp_index','analysis_run_id_index','analysis_run_version_index','facet_assessment_id_index','facet_assessment_score_index','facet_assessment_status_index','human_type_birth_index','event_type_date_index','period_culture_date_index','place_type_country_index','human_name_fulltext','place_label_fulltext','event_label_fulltext','period_label_fulltext','subject_label_fulltext'] AS expected_indexes
CALL db.constraints() YIELD name
WITH expected_constraints, expected_indexes, collect(name) AS actual_constraints
CALL db.indexes() YIELD name, state
WITH expected_constraints, expected_indexes, actual_constraints, collect(name) AS actual_indexes, [x IN collect(CASE WHEN state <> 'ONLINE' THEN name END) WHERE x IS NOT NULL] AS non_online_indexes
WITH expected_constraints, expected_indexes, actual_constraints, actual_indexes, non_online_indexes, [x IN expected_constraints WHERE NOT x IN actual_constraints] AS missing_constraints, [x IN actual_constraints WHERE NOT x IN expected_constraints] AS unexpected_constraints, [x IN expected_indexes WHERE NOT x IN actual_indexes] AS missing_indexes, [x IN actual_indexes WHERE NOT x IN expected_indexes] AS unexpected_indexes
RETURN size(expected_constraints) AS expected_constraint_count, size(actual_constraints) AS actual_constraint_count, missing_constraints, unexpected_constraints, CASE WHEN size(missing_constraints) = 0 THEN 'PASS' ELSE 'FAIL' END AS constraint_name_check_status, size(expected_indexes) AS expected_index_count, size(actual_indexes) AS actual_index_count, missing_indexes, unexpected_indexes, CASE WHEN size(missing_indexes) = 0 THEN 'PASS' ELSE 'FAIL' END AS index_name_check_status, non_online_indexes, CASE WHEN size(non_online_indexes) = 0 THEN 'PASS' ELSE 'FAIL' END AS index_state_check_status, CASE WHEN size(missing_constraints) = 0 AND size(missing_indexes) = 0 AND size(non_online_indexes) = 0 THEN 'PASS' ELSE 'FAIL' END AS bootstrap_schema_validation_status